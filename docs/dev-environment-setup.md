# Dev Environment Setup
[Home](./index.md)

The following steps were captured on a laptop with Windows freshly installed and the internet disconnected. All of the resources that were used for these steps were generated by running the [Build-DevResources.ps1](./scripts) script into a directory named `bundle`.

This can also be tested in a [Windows Sandbox](https://learn.microsoft.com/en-us/windows/security/application-security/application-isolation/windows-sandbox/windows-sandbox-overview) to prevent making persistent modifications to the machine conducting the testing. This is also the preferred approach for generating the [Linux resources](./linux.md) described in the [Linux Software](#linux-software) section below. Just be sure that virtualization capabilities are enabled in the system BIOS. It can be enabled with:

```powershell
Enable-WindowsOptionalFeature -FeatureName "Containers-DisposableClientVM" -All -Online
```

## Software

Simple software installation list (in order of installation):

Software | Version | Notes
---------|---------|------
Visual Studio Code | 1.79.2 | 
PowerShell 7 | 7.2.11 | 
Git | 2.41.0 | Use `VS Code` as editor and default new repositories to `main`.
.NET SDK | 7.0.305 | 
Node.js | 18.16.0 | Prevent installing online documentation shortcuts
Azure Data Studio | 1.44.1 | 
PowerToys | 0.70.1 | 
Terminal | 1.17.11461.0 | Make sure all terminals + VS Code are closed, and just double-click the bundle.
Azure CLI | 2.49.0 | 
SQL Server 2022 Express | 16.2211.5693.3 | New SQL Server installation. Uncheck Azure Extension for SQL Server. **Named Instance:** `DevSql`.
Docker Desktop | 4.20.1 | ***Must first perform the steps in [WSL + Ubuntu](#wsl--ubuntu) below***

## WSL + Ubuntu

Before Docker is installed, the system needs to be configured with WSL + Ubuntu.

From an administrative PowerShell console, enable WSL:

```powershell
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

![dism-enable-features](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/b3f176d1-7e52-4e16-bf2c-a926286e8762)

Restart the computer.

Install WSL2 Linux kernel update package for x64 machines, (located at `bundle\wsl\wsl-kernel-x64.msi`).

Set WSL2 as the default version:

```powershell
wsl --set-default-version 2
```

Move the Ubuntu distro from `bundle\wsl\ubuntu` to `$env:USERPROFILE\.wsl\ubuntu` and double-click `ubuntu.exe` to initialize the distro in WSL.

![install-ubuntu](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/6a59ea6e-90cc-4d8d-924f-a5770912407d)

Set Ubuntu as the default WSL distro, and check the status to verify:

```powershell
wsl -s Ubuntu

wsl --status
```

![wsl-status](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/0447da08-0d02-4eed-bcee-4d5cb1740c7b)

## Extensions

### Azure Data Studio

Open Azure Data Studio and open the Extensions view in the left sidebar. Click the menu and select *Install from VSIX...*:

![ads-install-from-vsix](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/4c7930fe-e83d-434b-b7dd-5de0ad9f27e1)

Navigate to `bundle\extensions\ads` and install each extension individually. Once installed, the Extensions view should look as follows:

![ads-vsix-installed](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/decf7396-e953-4e3e-b165-ab57187bd684)

### Visual Studio Code

Open Visual Studio Code and open the Extensions view in the left sidebar. CLick the menu and select *Install from VSIX...*:

![code-install-from-vsix](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/be5e09e9-157a-429e-b1dc-6eb1db9f23b5)

Select all `.vsix` packages from `bundle\extensions\vs-code` and click *Install*:

![code-select-vsix](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/9a5fa6f1-52a0-415f-90e1-233a9f162351)

After all extensions have been installed, refresh the Extensions view to verify all extensions are activated:

![code-vsix-installed](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/3fc76af8-67ac-4043-8765-835159580402)

## Azure Data Studio

Connect Azure Data Studio to `.\DevSql` by clicking `New -> New Connection`:

![ads-new-connection](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/fd5761d7-6413-4f1c-b39b-b1c055dde2b8)

Set *Server* to `.\DevSql` and change *Trust Server Certificate* to `True`, then click **Connect**:

![ads-setup-connection](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/0c127ecb-26fd-428c-8941-13e530c58465)

The server connection should then be setup in the Connections view:

![ads-connected](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/ef695a88-80bc-4281-b59b-88669bdfaca6)

## Linux Software

Open wsl and change directory to `bundle/linux`.

Install cached apt software:

```bash
sudo apt dpkg -i ./apt-cache/*.deb
```

Running `echo "$(command -v <command>)"` will verify that the packages have been installed:

![apt-verify](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/3bd0b3fe-6865-4975-b26e-b1454b3e533b)

Install .NET SDK:

```bash
cd <path>/<to>/bundle/linux/dotnet/

DOTNET_FILE=dotnet-sdk-<version>-linux-<arch>.tar.gz

export DOTNET_ROOT=~/.dotnet/

mkdir -p "$DOTNET_ROOT" && tar zxf "$DOTNET_FILE" -C "$DOTNET_ROOT"

export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools
```

Verify with `dotnet --list-sdks`:

![dotnet-list-sdks](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/0c18ff32-0189-4585-b3ec-48dc5ce31a98)

### apt-offline

In the `.home/admin` directory, I created an `offline.sig` file by running:

```bash
sudo apt-offline set ./offline.sig --update --upgrade
```

I transferred the `.home/admin` directory to my online workstation and, pointed at the `admin` directory, executed:

> This step took an unreasonably long amount of time to complete. Looking into writing a script that iterates through the `.sig` file to download the updates vs. using `apt-offline` in WSL. See [apt-offline: Script Package Downloads from Generated .sig Files](https://github.com/JaimeStill/azure-dev-resources/issues/15).

```bash
sudo apt-offline get -d ./update ./offline.sig
```

Once complete, I transferred the `admin/update` directory to `.home/admin/update` and executed:

```bash
sudo apt-offline install ./<path>/<to>/<admin>/<update>
```

## npm

Verified that cached dependencies for both projects can be installed.

Starting from `bundle/npm`, changed directory into both projects (`cache` and `optimus`) and ran `npm i --offline`:

![npm-install-offline](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/48dcb7fe-a936-4678-abc5-86a18a2aa776)

## NuGet

Moved the solution saved in `bundle/nuget/Solution` to `bundle/Solution` to simplify the testing process.

Configure the NuGet source:

```powershell
# add bundle/nuget as the local source
dotnet nuget add source <nuget-dir> -n "local"

# remove the nuget.org source
dotnet nuget remove source "nuget.org"
```

Test restoring NuGet dependencies for `bundle/Solution`:

```powershell
dotnet build
```

![nuget-build](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/bf40f51a-bcdc-4272-bb51-1c6891a8af4c)

## Docker

Test loading and creating cached Docker base images.

From `bundle\docker`:

```powershell
# load docker images
docker load -i mcr.microsoft.com-dotnet-aspnet-latest.tar
docker load -i mcr.microsoft.com-dotnet-sdk-latest.tar
docker load -i node-latest.tar
```

![docker-load](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/ac3ae1d3-ce87-4dd2-afff-1b370b2a7520)

```powershell
# create docker images
docker create mcr.microsoft.com/dotnet/sdk:latest
docker create mcr.microsoft.com/dotnet/aspnet:latest
docker create node:latest
```

![docker-create](https://github.com/JaimeStill/azure-dev-resources/assets/14102723/64558706-e59b-41e6-857e-a69a7f752114)


[Home](./index.md)