# WSL + Ubuntu
[Home](./index.md)

> The resources required to conduct the following steps are generated by the [`Build-WslCache.ps1`](./scripts/Build-WslCache.md) script.

https://learn.microsoft.com/en-us/windows/wsl/install-manual

```PowerShell
# enable WSL
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

# enable virtual machine feature
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

Restart the target machine. ***The remaining steps will not work properly if the machine is not restarted.***

Download and install the [WSL2 Linux kernel update package for x64 machines](https://aka.ms/wsl2kernelmsix64). This is listed as `wsl-kernel-<arch>.msi` in the generated `bundle/wsl` directory.

> The following will not work properly if the machine is not restarted

```PowerShell
# Set WSL2 as your default version
wsl --set-default-version 2
```

Copy the `bundle/wsl/ubuntu` directory to the target machine. Double-click `bundle/wsl/ubuntu/ubuntu.exe` to initialize the distro with a username and password. The distribution will then be connected to WSL. You can set it as the default distro with:

```powershell
wsl -s Ubuntu
```

You can also setup a Terminal profile by modifying the settings JSON file:

```json
{
    "guid": "{<guid>}",
    "hidden": false,
    "name": "Ubuntu",
    "source": "Windows.Terminal.Wsl"
}
```

## Caching WSL Resources

The PowerShell script [Build-WslCache.ps1](./scripts/Build-WslCache.md) defines the ability to download the latest WSL Linux Kernel and WSL Ubuntu bundle. These resources can then be transported to a disconnected network and used to enable WSL with Ubuntu.

Parameter | Type | Default Value | Description
----------|------|---------------|------------
Target | **string** | `..\wsl` | The cache target directory.
Arch | **string** | `x64` | The WSL Linux kernel and Ubuntu architecture. Valid values are: `x64` and `arm64`.

[Home](./index.md)